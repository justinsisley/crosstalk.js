function Crosstalk(t){var n=this;this.options={origin:"*",source:null,connectionTimeout:50,onConnectionFail:null};for(var e in t)this.options[e]=t[e];this.events={},this.options.source&&this._createTransport(),window.addEventListener("message",function(t){n._onMessage.call(n,t)},!1)}Crosstalk.prototype._createTransport=function(){var t=this;return this.el=document.createElement("iframe"),this.el.src=this.options.source,this.el.style.display="none",this.el.onload=function(){t._contentWindow=t.el.contentWindow,t.emit("ct_ping")},document.body.appendChild(this.el),setTimeout(function(){if(!t._connected){if(t._connectionFailed=!0,!t.onConnectionFail)throw new Error("Unable to connect to remote transport. Try increasing connectionTimeout.");t.onConnectionFail.call(t)}},this.options.connectionTimeout),this},Crosstalk.prototype._onMessage=function(t){if(!t||!t.source)return!1;this._contentWindow=t.source;var n=JSON.parse(t.data);if(!this._connected){if("ct_ping"===n.event)return this._connected=!0,this.emit("ct_pong");"ct_pong"===n.event&&(this._connected=!0)}if(this.events[n.event]){var e=this.events[n.event];delete n.event,e(n)}},Crosstalk.prototype.on=function(t,n){if("string"==typeof t)return this.events[t]=n;if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this.events[e]=t[e])},Crosstalk.prototype.emit=function(t,n){var e=this;return this._contentWindow||e._connectionFailed?(n=n||{},n.event=t,n=JSON.stringify(n),void this._contentWindow.postMessage(n,this.options.origin)):setTimeout(function(){e.emit.call(e,t,n)},this.options.connectionTimeout)};