function Crosstalk(t){this.options=t||{origin:"*",source:null},this.id=Crosstalk.generateId(),this.routes={},this.options.source&&this._createTransport(),window.addEventListener("message",this._onMessage,!1)}Crosstalk.generateId=function(){for(var t=32,o="0123456789abcdefghijklmnopqrstuvwxyz",e="",s=t;s>0;--s)e+=o[Math.round(Math.random()*(o.length-1))];return"ct_"+e},Crosstalk.prototype._createTransport=function(){var t=this;this._transportLoaded=!1,this_.el=document.createElement("iframe"),this_.el.src=this.options.source,this_.el.style.display="none",this_.el.onload=function(){t.emit("ping",{id:t.id})},document.body.appendChild(this_.el),setTimeout(function(){},50)},Crosstalk.prototype._onMessage=function(t){if(!t||!t.source)return!1;this._contentWindow=t.source;var o=JSON.parse(t.data);if(this.routes[o.method]){var e=this.routes[o.method];return delete o.method,e(o)}return!1},Crosstalk.prototype.on=function(t,o){if("string"==typeof t)return this.routes[t]=o;if("object"==typeof t)for(var e in config)config.hasOwnProperty(e)&&(this.routes[e]=config[e])},Crosstalk.prototype.emit=function(t,o){return this._contentWindow=this_.el.contentWindow,o=o||{},o.evt=t,o=JSON.stringify(o),this._contentWindow.postMessage(o,this.options.origin),o};